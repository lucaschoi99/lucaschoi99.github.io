---
title: "[DB 설계] 토이 프로젝트"
date: 2022-07-04 21:36:08
categories: DB Table Mapping

---

## Before the Project...

간단한 회원관리와 주문, 그리고 상품 등록과 조회를 할 수 있는 토이 프로젝트를 만들어 보려고 한다. 
DB, JPA 그리고 스프링 부트를 공부하면서 활용할 수 있는 부분을 직접 구현해보고 싶어 계획하게 되었다.

아무리 간단한 프로젝트여도, 시작하기 전에 지켜야 할 요구사항을 만들고 도메인 모델과 테이블을 설계해보려고 한다.

그 전에, 객체에서의 다대다(N:M) 관계를 왜 데이터베이스 테이블 관계로 표현하는 것을 절대적으로 피하라고 들었는데, 왜 그래야 하는지 조금 더 알아보고 싶었다.

- - -

## 왜 다대다(N:M)관계는 DB테이블 관계로 구현될 수 없는 것일까

다대다 관계를 두 테이블간의 매핑으로 구현할 수 없는 가장 큰 이유는 데이터 무결성(Data integrity) 때문이다.

데이터 무결성이란 데이터의 정확성, 일관성, 유효성이 유지되는 것을 말하며, 특히 관계형 데이터베이스에서 참조 무결성(Referential integrity)이란 참조 관계에 있는 두 테이블의 데이터가 항상 일관된 값을 갖도록 유지되는 것을 뜻한다.

그러나 다대다 관계의 두 테이블은 참조 무결성을 지키지 못하기 때문에 구현될 수 없다.


예를 들어, 대학병원의 의사들과 환자들의 관계는 다대다 관계라 할 수 있다. 한 명의 의사는 여러 명의 환자들을 진료하고, 한 명의 환자를 여러 명의 의사가 진료할 수 있기 때문이다. 그렇다면 의사들의 정보를 저장한 doctors 테이블과 환자들의 정보를 저장한 patients 테이블은 서로 참조 관계에 있게 된다.

만약 이때, patients 테이블의 한 명의 환자 정보를 삭제해야 하는 상황이 오게 되었는데 이 환자를 진료하던 doctors 테이블의 해당 의사는 참조값을 잃게 된다. 즉, 더 이상 존재하지 않는 데이터를 참조하게 되는 것이다. 따라서 참조 무결성이 깨지는 결과를 나타내기 때문에 이런 식의 구현은 불가하다.

- - -

## 다대다 관계 구현의 해결책

다대다 관계는 두 테이블 중간에 연결 테이블을 둠으로써 해결할 수 있다. 즉, 위의 예시를 사용한다면 의사 테이블과 연결 테이블을 1:N 관계로, 환자 테이블과 연결 테이블도 1:M 관계로 설정한다면, 다대다 관계를 그대로 유지하면서 참조 무결성을 위반하지 않아 문제를 해결할 수 있다.

- - -
참고한 링크:  
https://untitledtblog.tistory.com/123  
https://m.blog.naver.com/damoen7/221406926750


