---
title: "[도메인 모델, 테이블 설계] 토이 프로젝트"
date: 2022-07-05 01:07:42
categories: DB Domain Table Mapping

---

## 진행할 프로젝트에 대하여

프로젝트에서 구현할 요구사항과 기능은 다음과 같다.

- 회원(Member)
  - 등록과 조회
- 상품(Item)
  - 등록, 수정, 조회
- 주문(Order)
  - 주문, 조회, 취소
- 그 외
  - 상품은 도서, 음반, 영화가 있으며 카테고리로 구분할 것.
  - 주문 취소와 관련해 상품 재고 관리를 구현할 것.

요구사항을 고려해 회원과 상품, 그리고 주문 도메인의 관계를 설계한 것은 다음과 같다.

<img width="588" alt="image" src="https://user-images.githubusercontent.com/73485743/177123475-2e69a2b3-0d85-49da-a49f-29bcd4fe6665.png">

회원은 여러 주문을 할 수 있으므로 1:N의 관계다. 주문과 배송은 1:1의 관계로 한 개의 주문당 한 번의 배송이 이루어지는 것을 나타낼 수 있다. 주문과 상품은 N:M, 즉 다대다 관계다. 한 번 주문할 때 여러 상품이 골라질 수 있고, 하나의 상품이 여러 주문에 들어갈 수 있기 때문이다. 



앞선 글에서 관계형 데이터베이스는 N:M 의 연관관계를 테이블 관계로 풀어낼 수 없음을 알아보았다. 따라서 주문상품이라는 연관 테이블을 한 개 만들어 주문과 상품 테이블의 N:M 관계를 구현할 것이다. 상품은 도서, 음반, 영화로 구분되고 공통 속성을 뽑아낸 상속 구조로 표현할 것이다. 상품과 카테고리는 N:M 관계로 구현할 것이다. 



마찬가지로, 앞선 글에서 알아보았듯이 구현할 때는 연관 테이블을 만들고 최대한 `@ManyToMany` 어노테이션은 사용하지 않을 계획이다.


- - -


## 도메인 모델

<img width="581" alt="image" src="https://user-images.githubusercontent.com/73485743/177127704-886c550a-2368-4082-82b9-b7601d7605de.png">



프로젝트에 사용될 엔티티와 속성, 관계를 나타낸 모델이다.



크게 복잡한 내용은 없지만, 도메인 모델 설계에서 가장 신경 썼던 부분은 1**:N (일대다) 관계에서 누가 연관관계의 주인이 되어 추가, 수정, 삭제되는 데이터를 관리할 것인지**를 정하는 일이었다.



그 기준은 테이블 설계를 할 때 명확히 드러났다. 바로 두 테이블 중 N(다) 관계에 위치한 테이블이 데이터를 관리해야 한다는 것이었다. 테이블 설계 시 간단하게 생각했을 때 N(다) 관계에 있는 쪽에서 FK(외래키)를 관리한다. 따라서 자연스럽게 연관관계의 주인이 되는 것은 외래키를 관리하는 테이블에서 하는 것이 훨씬 유리하고 편하다. 



물론 반대의 경우가 안되는 것은 아니다. 그러나 방법을 반대로 함으로써 얻을 수 있는 효용이 거의 없다고 판단하였다.

- - -

## 테이블 설계

<img width="576" alt="image" src="https://user-images.githubusercontent.com/73485743/177127929-c5b2725c-6f3c-4fc9-9d62-ef29aef42c84.png">



Order 테이블의 경우 Member 테이블과 N(다) 관계에 있기 때문에 어떤 회원의 주문인지 관리하는 MEMBER_ID를 FK(외래키)로 두고 있다. 따라서 Member 테이블과의 연관관계에서 Order 테이블이 데이터의 추가, 수정, 삭제 등 행위의 주인이 되는 것이 자연스럽다.



마찬가지로 Order 테이블과 Delivery 테이블의 1:1 연관관계에서도 DELIVERY_ID를 Order 테이블이 FK(외래키)로 가지고 있기 때문에 연관관계의 주인으로 지정하는 것이 좋다. 참고로 이 경우에는 1:N의 관계와는 다르게 두 개의 테이블 중 어느 테이블이라도 FK(외래키)를 가지고 있을 수 있다.


- - -


참고: 인프런 김영한님 강의 - 실전! 스프링 부트와 JPA 활용1 - 웹 애플리케이션 개발v2.1.pdf 

