---
title: "[JPA ORM] 값 타입 (Value Type)"
date: 2022-06-26 23:43:01
categories: JPA ORM Embedded Collections
---

## JPA 데이터 타입의 분류

JPA가 제공하는 데이터 타입은 크게 2가지로 나눌 수 있다. (Entity type, Value type)

- 엔티티(Entity) 타입

  `@Entity` 로 정의하는 객체 타입이다. 식별자가 존재하기 때문에 데이터 변경에도 추적 가능하다는 특징이 있다.

  또한 클래스 속성들의 Lifecycle은 포함된 Entity 클래스와 함께하게 된다.

- 값 타입 (Value type)

  단순히 값으로써 사용하는 자바 타입이나 객체를 뜻한다. 식별자가 없으므로 데이터 변경에 추적이 불가하다는 특징이 있다.

  값 타입의 종류에는 크게 아래와 같은 타입이 존재한다.

  - 기본값 타입

    int, double과 같은 기본타입, Integer, Long과 같은 레퍼런스 클래스 타입 등이 있다.

  - Embedded 타입

    새로운 값 타입을 직접 정의해서 만든 타입을 뜻한다. 

    예를 들어, 날짜나 주소에 관련된 속성 값들을 묶어 Embedded 타입으로 만들면 응집도 높은 코드를 만들 수 있다.

    Embedded 타입을 정의하는 클래스에 `@Embeddable`, 사용하는 곳에 `@Embedded` 어노테이션을 달고 사용하면 된다.

  - Collection Value 타입

    일반적인 관계형 데이터베이스 테이블에는 데이터 값이 collection 형태 (List나 Set과 값은 형태)로 저장이 불가하다. 따라서 별도의 테이블을 두고 `@ElementCollection`, `CollectionTable` 어노테이션을 달고 사용해야 한다.

    한 가지 유의할 점은, 데이터 수정 시 update 쿼리가 나가지 않고 주인 Entity와 연관된 모든 데이터를 삭제하고 남아있는 현재 값을 다시 저장하기 때문에 예상치 못하게 쿼리가 많이 나갈 수 있다.

    따라서, 실무에서는 아주 간단한 상황이 아니라면 Collection 값타입이 아닌 1:N (일대다) 관계로 그냥 매핑하는 편이 낫다.

- - -

## Embedded Type의 장점

우선 재사용 가능하다는 장점이 있다. 예를 들어, Address 클래스를 `@Embeddable` 타입으로 만들면, 다른 주소와 관련된 속성값을 묶어 표현하는 모든 Entity 클래스들도 이를 활용할 수 있다.

또한, 해당 값 타입만 사용하는 의미 있는 method을 선언하고 이를 이용하는 모든 Entity에서 사용하게 할 수 있다는 장점이 있다.

다만 여기서 주의할 점은, `@Embedded` 타입으로 생성 시 항상 새로운 객체를 선언해 주어야 한다는 것이다. 

Embedded 타입은 자바의 기본 타입이 아닌 객체 타입이기 때문에 공유 참조를 주의해야 하기 때문이다. 만약 같은 객체로 여러 Entity에서 참조하게 되면 예상치 못한 데이터 수정과 삭제가 일어나 혼란을 초래할 수 있다.

즉, Embedded 타입을 사용할 때에는 불변이라는 제약을 걸어주는 것이 바람직한 사용법이다.

- - -

## 정리

기초적인 개념은 제외하고, Embedded 타입과 Collection value 타입은 기억해야 할 필요가 있다.

Embedded 타입을 사용하면 비슷한 형식의 속성 값을 묶어 관리함으로써 응집도 높고 관리가 쉬운 구조를 만들 수 있다는 이점을 가져간다. 또, 같은 속성 값을 사용하는 다른 Entity에서도 재사용 할 수 있어 깔끔한 코드를 유지할 수 있다. 

그러나, 생성할 때마다 새로운 객체를 선언해 주어야 하며 변경할 때도 해당 데이터를 remove하고 변경사항이 적용된 새로운 객체를 add한다는 것을 주의해야 한다.

Collection value 타입은 상황이 단순할 때 (예를 들면, favorite_menu 속성에 치킨, 피자 등을 중복체크하는 상황) 사용하는 것이 좋다. 데이터가 많은 상황에서 변경 사항이 발생하면, 연관된 모든 데이터를 삭제하고 다시 남은 데이터를 삽입하는 방법을 사용하기 때문이다.

 따라서 상황이 복잡해지면 1:N 매핑으로 따로 Entity 클래스를 만들어 구현하는 것이 좋다.


- - -


**참고 강의안:** 인프런 김영한님 강의안, 자바 ORM 표준 JPA 프로그래밍 - 기본편 중 09.값 타입.pdf
